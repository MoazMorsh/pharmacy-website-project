<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Checkout Form</title>
    <link rel="icon" href="https://assets.pharmeasy.in/apothecary/images/favicon.png">
    <!-- font awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.2/css/all.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css" integrity="sha384-oSrq3BO+WAt0qGbyXMTYbg4JAmKJAP+a41f5NjWEXQjzM5mwIKR1yZlii1Q4LYkX" crossorigin="anonymous">
    <link rel="stylesheet" href="/assets/css/checkout.css">
</head>
<body>

    <!-- header -->
    <header class="header bg-blue">
        <nav class="navbar bg-blue">
            <div class="container flex">
                
                <a href="/" target="_self" class="logo">
                    <i class="fa fa-medkit"></i> Meditrack
                </a>
                
                <div style="position: relative;">
                    <div style="position: relative;">
                    <div class="profile-icon" onclick="togglePopup()">
                        <img id="profileIconImg" 
                             src="/api/get-profile-picture" 
                             alt="User"
                             onerror="this.src='https://kzvtniajqclodwlokxww.supabase.co/storage/v1/object/sign/images/blue-circle-with-white-user.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5Xzg2ZjA3MzBjLWZjM2ItNGYwYy1iNDc1LWRkZWU1Y2QzYjZhNCJ9.eyJ1cmwiOiJpbWFnZXMvYmx1ZS1jaXJjbGUtd2l0aC13aGl0ZS11c2VyLmpwZyIsImlhdCI6MTc0NjcwNDQ5MywiZXhwIjoxNzc4MjQwNDkzfQ.ws3JY7lQCYwT-DYR-Ni0EWxGiXmOUmG1DnLMj2eBy_M'">
                      </div>
                  
                    <div class="popup" id="profilePopup">
                      <a href="/pages/pharmacist-panel.html">Pharmacist Panel<i class="fas fa-external-link-alt" style="margin-left: 5px;"></i></a>
                      <p><strong>Username:</strong> JohnDoe</p>
                      <p><strong>Email:</strong> johndoe@example.com</p>
                      <p><strong>Role:</strong> Pharmacist</p>
                      <a href="#" class="logout" onclick="logout()" style="color: red;">
                        <i class='fas fa-sign-out-alt' style="color: red; margin-right: 5px; margin-top: 15px;"></i>
                        <span class="text">Logout</span>
                      </a>
                      
                    </div>
                  </div>
                  
                <button type="button" class="navbar-show-btn">
                    <img src="/assets/images/ham-menu-icon.png">
                </button>

                <div class="navbar-collapse bg-white">
                    <button type="button" class="navbar-hide-btn">
                        <img src="/assets/images/close-icon.png">
                    </button>
                    <ul class="navbar-nav">
                        <li class="nav-item"><a href="/" class="nav-link">Home</a></li>
                        <li class="nav-item"></li><a href="/#services" class="nav-link">Subscription</a></li>
                        <li class="nav-item"></li><a href="/#banner-two" class="nav-link">Quick Order</a></li>
                        <li class="nav-item"><a href="/pages/products.html" class="nav-link">Products</a></li>
                        <li class="nav-item"><a href="/pages/cart.html" class="nav-link" id="cart-link"> Cart <span id="cart-counter">(0)</span>
                        </a></li>
                    </ul>
                    <div class="search-bar">
                    </div>
                </div> 
            </div>
        </nav>
    </header>
    <!-- end of header -->

    <main>
        
        <div class="wrapper">
            <div class="payment">
              <div class="payment-logo">
                <p>p</p>
              </div>
              
              
              <h2>Payment Gateway</h2>
              <div class="payment-form">
                <div class="card space icon-relative">
                  <label class="payment-label">Card holder:</label>
                  <input type="text" class="payment-input" placeholder="Coding Market">
                  <i class="fas fa-user"></i>
                </div>
                <div class="card space icon-relative">
                  <label class="payment-label">Card number:</label>
                  <input type="text" class="payment-input" data-mask="0000 0000 0000 0000" placeholder="Card Number">
                  <i class="far fa-credit-card"></i>
                </div>
                <div class="card-grp space">
                  <div class="card-item icon-relative">
                    <label class="payment-label">Expiry date:</label>
                    <input type="text" name="expiry-data" class="payment-input" data-mask="00 / 00"  placeholder="00 / 00">
                    <i class="far fa-calendar-alt"></i>
                  </div>
                  <div class="card-item icon-relative">
                    <label class="payment-label">CVC:</label>
                    <input type="text" class="payment-input" data-mask="000" placeholder="000">
                    <i class="fas fa-lock"></i>
                  </div>
                </div>
                  
                <div class="pay-btn">
                  Pay
                </div> 
                <div class="pay-icons">
                    <i class="fa-brands fa-cc-visa"></i>
                    <i class="fa-brands fa-cc-mastercard"></i>
                    <i class="fa-brands fa-cc-paypal"></i>
                    <i class="fa-brands fa-cc-apple-pay"></i>
                    <i class="fa-brands fa-cc-amazon-pay"></i>
                </div>
                 
              </div>
            </div>
          </div>
    </main>

    <!-- footer  -->
 <footer id="footer" class="footer text-center">
    <div class="container">
        <div class="footer-inner text-white py grid">
            <div class="footer-item">
                <h3 class="footer-head">about us</h3>
                <div class="icon">
                    <img src="">
                </div>
                <p class="text text-md">Meditrack is more than a service—it's a commitment to your health. We ensure timely, reliable medicine deliveries, so you never have to worry about missing a dose!</p>
                <ul>
                    <h3 class="footer-head"></h3>
                    <li>Order Medicine</li>
                    <li>HealthCare Products</li>
                    <li>Health Blog</li>
                </ul>
            </div>

            <div class="footer-item">
                <h3 class="footer-head">tags</h3>
                <ul class="tags-list flex">
                    <li>COVID Essentials</li>
                    <li>Personal Care</li>
                    <li>Health Food & Drinks</li>
                    <li>Supplements</li>
                    <li>Mother & Baby Care</li>
                    <li>Home Care</li>
                </ul>
            </div>

            <div class="footer-item">
                <h3 class="footer-head">Quick Links</h3>
                <ul>
                    <li><a href="#" class="text-white">Our Services</a></li>
                    <li><a href="#" class="text-white">Our Plan</a></li>
                    <li><a href="#" class="text-white">Privacy Policy</a></li>
                    
                </ul>
            </div>

            <div class="footer-item">
                <h3 class="footer-head">Make your first Order</h3>
                <p class="text text-md">Customer Support Here for You.</p>
                <ul class="appointment-info">
                    <li>8:00 AM - 11:00 AM</li>
                    <li>2:00 PM - 05:00 PM</li>
                    <li>8:00 PM - 11:00 PM</li>
                    <li>
                        <i class="fas fa-envelope"></i>
                        <span>meditrack@gmail.com</span>
                    </li>
                    <li>
                        <i class="fas fa-phone"></i>
                        <span>+02 2411-5401</span>
                    </li>
                </ul>
            </div>
        </div>

        <div class="footer-links">
            <ul class="flex">
                <li><a href="#" class="text-white flex"> <i class="fab fa-facebook-f"></i></a></li>
                <li><a href="#" class="text-white flex"> <i class="fab fa-twitter"></i></a></li>
                <li><a href="#" class="text-white flex"> <i class="fab fa-linkedin"></i></a></li>
            </ul>
        </div>
    </div>
</footer>
<!-- end of footer  -->

    <script>
        // ----------------js for message after click pay button-----------
        document.addEventListener('DOMContentLoaded', function() {
    // Get cart items from localStorage
    const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
    const payBtn = document.querySelector('.pay-btn');
    
    // Payment form validation and submission
    payBtn.addEventListener('click', function() {
        // Get all input fields
        const cardHolder = document.querySelector('input[placeholder="Coding Market"]');
        const cardNumber = document.querySelector('input[placeholder="Card Number"]');
        const expiryDate = document.querySelector('input[name="expiry-data"]');
        const cvc = document.querySelector('input[placeholder="000"]');
        
        // Validate all fields
        if (!cardHolder.value.trim()) {
            showError(cardHolder, 'Card holder name is required');
            return;
        }
        
        if (!cardNumber.value.trim() || cardNumber.value.replace(/\s/g, '').length !== 16) {
            showError(cardNumber, 'Valid card number is required (16 digits)');
            return;
        }
        
        if (!expiryDate.value.trim() || !/^\d{2}\s\/\s\d{2}$/.test(expiryDate.value)) {
            showError(expiryDate, 'Valid expiry date required (MM / YY)');
            return;
        }
        
        if (!cvc.value.trim() || cvc.value.length !== 3) {
            showError(cvc, 'Valid CVC required (3 digits)');
            return;
        }
        
        // If all validations pass
        processPayment(cardHolder.value, cardNumber.value, expiryDate.value, cvc.value);
    });
    
    function showError(inputElement, message) {
        // Remove any existing error messages
        const existingError = inputElement.parentElement.querySelector('.error-message');
        if (existingError) {
            existingError.remove();
        }
        
        // Add red border
        inputElement.style.borderColor = '#ff4444';
        
        // Create and display error message
        const errorElement = document.createElement('div');
        errorElement.className = 'error-message';
        errorElement.style.color = '#ff4444';
        errorElement.style.fontSize = '12px';
        errorElement.style.marginTop = '5px';
        errorElement.textContent = message;
        
        inputElement.parentElement.appendChild(errorElement);
        
        // Focus on the problematic field
        inputElement.focus();
    }
    
    function processPayment(cardHolder, cardNumber, expiryDate, cvc) {
        // In a real app, you would send this to your payment processor
        // For demo purposes, we'll simulate a successful payment
        
        // Create order summary
        const orderSummary = createOrderSummary(cardNumber.slice(-4));
        
        // Show success message
        showSuccessMessage(orderSummary);
        
        // Clear cart
        localStorage.removeItem('cart');
    }
    
    function createOrderSummary(last4Digits) {
        const cartItems = JSON.parse(localStorage.getItem('cart')) || [];
        let total = 0;
        
        // Calculate total and create items list
        const itemsList = cartItems.map(item => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;
            return `
                <div class="order-item">
                    <span>${item.name} (${item.quantity}x)</span>
                    <span>£${itemTotal.toFixed(2)}</span>
                </div>
            `;
        }).join('');
        
        return `
            <div class="order-success">
                <div class="success-icon">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Payment Successful!</h3>
                <div class="order-details">
                    <p><strong>Card:</strong> **** **** **** ${last4Digits}</p>
                    <p><strong>Date:</strong> ${new Date().toLocaleString()}</p>
                    <div class="order-items">
                        ${itemsList}
                    </div>
                    <div class="order-total">
                        <span>Total:</span>
                        <span>£${total.toFixed(2)}</span>
                    </div>
                </div>
                <button class="continue-shopping" onclick="window.location.href='products.html'">
                    Continue Shopping
                </button>
            </div>
        `;
    }
    
    function showSuccessMessage(content) {
        // Create overlay
        const overlay = document.createElement('div');
        overlay.className = 'payment-overlay';
        overlay.style.position = 'fixed';
        overlay.style.top = '0';
        overlay.style.left = '0';
        overlay.style.width = '100%';
        overlay.style.height = '100%';
        overlay.style.backgroundColor = 'rgba(0,0,0,0.7)';
        overlay.style.display = 'flex';
        overlay.style.justifyContent = 'center';
        overlay.style.alignItems = 'center';
        overlay.style.zIndex = '1000';
        
        // Create success box
        const successBox = document.createElement('div');
        successBox.className = 'success-box';
        successBox.style.backgroundColor = 'white';
        successBox.style.padding = '30px';
        successBox.style.borderRadius = '10px';
        successBox.style.maxWidth = '500px';
        successBox.style.width = '90%';
        successBox.innerHTML = content;
        
        // Add to DOM
        overlay.appendChild(successBox);
        document.body.appendChild(overlay);
    }
});
    </script>

    <script>
        // script for the cart counter and updated after any edits in the page for the quantity or removed items

    /// cart.js - This should be loaded on all pages

    // Global cart functions
    let cart = JSON.parse(localStorage.getItem('cart')) || [];

function updateCartCounter() {
    const counter = document.getElementById('cart-counter');
    if (counter) {
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        counter.textContent = totalItems;
    }
}

function saveCart() {
    localStorage.setItem('cart', JSON.stringify(cart));
    updateCartCounter(); // Update counter whenever cart changes
}

// Initialize counter when page loads
document.addEventListener('DOMContentLoaded', updateCartCounter);


document.addEventListener('DOMContentLoaded', function() {
// No need to load cart here - use the global cart variable
const cartItemsContainer = document.getElementById('cart-items');
const cartTotalElement = document.getElementById('cart-total');

function renderCart() {
    cartItemsContainer.innerHTML = '';
    let total = 0;

    if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<tr><td colspan="5">Your cart is empty</td></tr>';
        cartTotalElement.textContent = '0.00';
        updateCartCounter(); // Update counter here too
        return;
    }

    cart.forEach((item, index) => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;

        const row = document.createElement('tr');
        row.innerHTML = `
            <td>${item.name}</td>
            <td>
                <button class="quantity-btn" onclick="updateQuantity(${index}, -1)">-</button>
                <span class="quantity">${item.quantity}</span>
                <button class="quantity-btn" onclick="updateQuantity(${index}, 1)">+</button>
            </td>
            <td>£${item.price.toFixed(2)}</td>
            <td>£${itemTotal.toFixed(2)}</td>
            <td><button class="remove-btn" onclick="removeItem(${index})">Remove</button></td>
        `;
        cartItemsContainer.appendChild(row);
    });

    cartTotalElement.textContent = total.toFixed(2);
}

// Make these functions global
window.updateQuantity = function(index, change) {
    const newQuantity = cart[index].quantity + change;
    
    if (newQuantity < 1) {
        removeItem(index);
        return;
    }
    
    cart[index].quantity = newQuantity;
    saveCart(); // Use the shared save function
    renderCart();
}

window.removeItem = function(index) {
    cart.splice(index, 1);
    saveCart(); // Use the shared save function
    renderCart();
}

// Initial render
renderCart();
});
    </script>

    <script src="/assets/js/checkout.js"></script>
    <script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.mask/1.14.15/jquery.mask.min.js"></script>
    <script src="/assets/js/Search.js"></script>
</body>
</html>