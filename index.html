<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MediTrack</title>
    <link rel="icon" href="https://assets.pharmeasy.in/apothecary/images/favicon.png">
    <!-- font awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta2/css/all.min.css" integrity="sha512-YWzhKL2whUzgiheMoBFwW8CKV4qpHQAEuvilg9FAn5VJUDwKZZxkJNuGM4XkWuk94WCrrwslk8yWNGmY1EduTA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <!-- normalize css -->
    <link rel = "stylesheet" href = "/assets/css/normalize.css">
    <!-- custom css -->
    <link rel = "stylesheet" href = "/assets/css/main.css">

    
</head>
<body>
    

    <!-- header -->
    <header class = "header bg-blue">
        <nav class = "navbar bg-blue">
            <div class = "container flex">
                
                <a href="/" target="_self" class="logo">
                    <i class="fa fa-medkit"></i> Meditrack
                </a>
                
                <div style="position: relative;">
                    <div class="profile-icon" onclick="togglePopup()">
                        <img id="profileIconImg" 
                             src="/api/get-profile-picture" 
                             alt="User"
                             onerror="this.src='https://kzvtniajqclodwlokxww.supabase.co/storage/v1/object/sign/images/blue-circle-with-white-user.jpg?token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InN0b3JhZ2UtdXJsLXNpZ25pbmcta2V5Xzg2ZjA3MzBjLWZjM2ItNGYwYy1iNDc1LWRkZWU1Y2QzYjZhNCJ9.eyJ1cmwiOiJpbWFnZXMvYmx1ZS1jaXJjbGUtd2l0aC13aGl0ZS11c2VyLmpwZyIsImlhdCI6MTc0NjcwNDQ5MywiZXhwIjoxNzc4MjQwNDkzfQ.ws3JY7lQCYwT-DYR-Ni0EWxGiXmOUmG1DnLMj2eBy_M'">
                      </div>
                  
                    <div class="popup" id="profilePopup">
                        <a id="profileLink" href="#">
                            <span id="profileLinkText"></span> 
                            <i class="fas fa-external-link-alt" style="margin-left: 5px;"></i>
                        </a>
                        <p><strong>Username:</strong></p>
                        <p><strong>Email:</strong></p>
                        <p><strong>Role:</strong></p>
                        
                        <a href="/pages/edit-profile.html" class="edit-profile" style="color: #3498db; display: block; margin-top: 10px;">
                            <i class='fas fa-user-edit' style="color: #3498db; margin-right: 5px;"></i>
                            <span class="text">Edit Profile</span>
                        </a>
                        
                        <a href="#" class="logout" onclick="logout()" style="color: red; display: block; margin-top: 10px;">
                            <i class='fas fa-sign-out-alt' style="color: red; margin-right: 5px;"></i>
                            <span class="text">Logout</span>
                        </a>
                    </div>
                      
                  </div>
                  
                <!-- <button type = "button" class = "navbar-show-btn">
                    <img src = "src/assets/images/ham-menu-icon.png">
                </button> -->

                <div class = "navbar-collapse bg-white">
                    <button type = "button" class = "navbar-hide-btn">
                        <img src = "/assets/images/close-icon.png">
                    </button>
                    <ul class = "navbar-nav">
                        <li class = "nav-item">
                            <a href = "/" target="_self" class = "nav-link">Home</a>
                        </li>
                        <li class = "nav-item">
                            <a href = "#about" class = "nav-link">About</a>
                        </li>
                        <li class = "nav-item">
                            <a href = "#services" class = "nav-link">Service</a>
                        </li>
                        <li class = "nav-item">
                            <a href = "#banner-two" class = "nav-link">Quick Order</a>
                        </li>
                        <li class = "nav-item">
                            <a href = "#package-service" class = "nav-link">Subscription</a>
                        </li>
                        <li class = "nav-item">
                            <a href = "/pages/products.html" class = "nav-link">Products</a>
                        </li>
                        <li class = "nav-item">
                            <a href = "/pages/cart.html" class = "nav-link">Cart</a>
                        </li>
                        <li class = "nav-item">
                            <a href = "#contact" class = "nav-link">Contact</a>
                        </li>
                    </ul>
                    <!-- <a href="/pages/admin.html" class="admin-icon" id="adminIcon" >  style="display: none;"
                        <i class="fa-solid fa-user"></i> 
                    </a>
                     -->
                    <div class="search-bar">
    <!-- <form id="searchForm">
        <input type="search" id="searchBar" class="search-control" placeholder="Search products">
        <button type="button" id="search-button">Search</button>
    </form> -->
</div>
                    
                    
                    
                    
                       
                </div> 
            </div>
        </nav>

        <div class = "header-inner text-white text-center">
            <div class = "container grid">
                <div class = "header-inner-left">
                    <h1>your most trusted<br> <span>health partner</span></h1>
                    <p class = "lead">the best match services for you</p>
                    <p class = "text text-md">Meditrack, revolutionizing online pharmacy access with trust and efficiency. Seamless connections, secure healthcare, and effortless medicine delivery at your fingertips.</p>
                    <div class = "btn-group">
                        <a href = "#" class = "btn btn-white">Learn More</a>
                        <a href = "/pages/login.html" class = "btn btn-light-blue">Sign In</a>
                    </div>
                </div>
                <div class = "header-inner-right">
                    <img src = "/assets/images/header.jpg.png">
                </div>
            </div>
        </div>
    </header>
    <!-- end of header -->

    <main>
        <!-- about section -->
        <section id = "about" class = "about py">
            <div class = "about-inner">
                <div class = "container grid">
                    <div class = "about-left text-center">
                        <div class = "section-head">
                            <h2>About Us</h2>
                            <div class = "border-line"></div>
                        </div>
                        <p class = "text text-lg">MediTrack revolutionizes the way you access medicine in Cairo, EG. Our innovative search engine connects you with local pharmacies, allowing you to check the availability of your required medications effortlessly. If your medicine is out of stock, we provide substitute suggestions to ensure you never miss a dose. Experience the convenience of MediTrack and take control of your health today!</p>
                        <a href = "#about" class = "btn btn-white">Learn More</a>
                    </div>
                    <div class = "about-right flex">
                        <div class = "img">
                            <img src = "/assets/images/about2.png">
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- end of about section -->

        <!-- banner one -->
        <section id = "banner-one" class = "banner-one text-center">
            <div class = "container text-white">
                <blockquote class = "lead"><i class = "fas fa-quote-left"></i> When your desired medicine is out of stock, MediTrack has you covered with substitute suggestions. <i class = "fas fa-quote-right"></i></blockquote>
                <small class = "text text-sm">- MediTrack Here for You!</small>
            </div>
        </section>
        <!-- end of banner one -->

        <!-- services section -->
        <section id = "services" class = "services py">
            <div class = "container">
                <div class = "section-head text-center">
                    <h2 class = "lead">The Best Pharmacy makes all medicines available</h2>
                    <p class = "text text-lg">A perfect way to show your pharmacy services</p>
                    <div class = "line-art flex">
                        <div></div>
                        <img src = "/assets/images/4-dots.png">
                        <div></div>
                    </div>
                </div>
                <div class = "services-inner text-center grid">
                    <article class = "service-item">
                        <div class = "icon">
                            <img src = "/assets/images/service-1.png">
                        </div>
                        <h3>Medicines</h3>
                        <p class = "text text-sm">Explore our wide range of medicines, including prescription and over-the-counter medications, to support your health and well-being. From pain relief and cold remedies to chronic condition treatments, we provide trusted pharmaceutical solutions to meet your needs. Shop safely and conveniently with us.</p>
                    </article>

                    <article class = "service-item">
                        <div class = "icon">
                            <img src = "/assets/images/service-2.png">
                        </div>
                        <h3>HealthCare</h3>
                        <p class = "text text-sm">Discover a wide range of skincare, personal care, and wellness products designed to nourish, protect, and enhance your daily routine for a healthier, more radiant you.</p>
                    </article>

                    <article class = "service-item">
                        <div class = "icon">
                            <img src = "/assets/images/service-3.png">
                        </div>
                        <h3>Health Blog</h3>
                        <p class = "text text-sm">Explore expert insights, wellness tips, and the latest health trends to help you make informed decisions about your well-being and live a healthier, more balanced life.</p>
                    </article>

                    <article class = "service-item">
                        <div class = "icon">
                            <img src = "/assets/images/service-4.png">
                        </div>
                        <h3>Supplements</h3>
                        <p class = "text text-sm">Boost your health with our wide selection of high-quality supplements, including essential vitamins, minerals, and nutritional support tailored to enhance your energy, immunity, and overall wellness.</p>
                    </article>
                </div>
            </div>
        </section>
        <!-- end of services section -->

        <!-- banner two section -->
        <section id = "banner-two" class = "banner-two text-center">
            <div class = "container grid">
                <div class = "banner-two-left">
                    <img src = "/assets/images/banner-2XX.png">
                </div>
                <div class = "banner-two-right">
                    <p class = "lead text-white">Order with prescription, Upload prescription and we will deliver your medicine.</p>
                    <div class="btn-group">
                        <button class="btn btn-white" onclick="openModal()">Learn More</button>

                        <div class="upload-container">
                            <input type="file" id="fileInput" accept="image/*, .pdf">
                            
                            <button class="btn btn-light-blue" id="uploadBtn">Upload</button>
                          </div>
                    </div>
                </div>
            </div>
            <!-- Modal -->
            <div id="uploadModal" class="modal">
                <div class="modal-content">
                    <span class="close" onclick="closeModal()">&times;</span>
                    <h2>How to Upload Your Prescription</h2>
                    <ol>
                        <li>Click the 'Upload' button.</li>
                        <li>Select your prescription file from your device.</li>
                        <li>Make sure the image is clear and readable.</li>
                        <li>Submit the file and wait for confirmation.</li>
                        <li>Wait for approval from Admin and Confirm the order.</li>
                    </ol>
                </div>
            </div>
        </section>
        <!-- end of banner two section -->

        <!-- Partners section -->
        <section id = "doc-panel" class = "doc-panel py">
            <div class = "container">
                <div class = "section-head">
                    <h2>Our Partners</h2>
                </div>

                <div class = "doc-panel-inner grid">
                    <div class = "doc-panel-item">
                        <div class = "img flex">
                            <img src = "/assets/images/Hatem_Amerjpg.jpg" alt = "partner image">
                            <div class = "info text-center bg-blue text-white flex">
                                <p class = "lead">Hatem Amer</p>
                                <p class = "text-lg">Associate Minister of Health</p>
                            </div>
                        </div>
                    </div>

                    <div class = "doc-panel-item">
                        <div class = "img flex">
                            <img src = "/assets/images/Riad-Armanious.jpg" alt = "partner image">
                            <div class = "info text-center bg-blue text-white flex">
                                <p class = "lead">Riad Armanious</p>
                                <p class = "text-lg">chief executive officer, Eva Pharma</p>
                            </div>
                        </div>
                    </div>

                    <div class = "doc-panel-item">
                        <div class = "img flex">
                            <img src = "/assets/images/Ahmed_elsobky.png
                            " alt = "partner image">
                            <div class = "info text-center bg-blue text-white flex">
                                <p class = "lead"> Ahmed Elsobky</p>
                                <p class = "text-lg">Chairman of Board of Directors</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- end of partners section -->

        <!-- package services section -->
        <section id = "package-service" class = "package-service py text-center">
            <div class = "container">
                <div class = "package-service-head text-white">
                    <h2>Package Service</h2>
                    <p class = "text text-lg">Become a +PLUS member<br>Save flat 5% discoount & enjoy free delivery with plus Membership</p>

                    <button class="subscribe-btn" onclick="subscribeopenModal()">Subscribe</button>

                    <div id="subscribeModal" class="modal">
                      <div class="modal-content">
                        <span class="close" onclick="subscribecloseModal()">&times;</span>
                        <h2>Subscribe to Our Pharmacy</h2>
                        <p>
                          Get access to exclusive medical content, special offers, and the latest pharmacy updates, Also get your based Medicines monthly Automatically.<br><br>
                          Subscription fee: <strong>100 EGP per month</strong>.
                        </p>
                        <button class="subscribe-btn" onclick="openPaymentModal()">Confirm Subscription</button>
                      </div>
                    </div>


                    <!-- Payment Modal -->
                    <div id="paymentModal" class="modal">
                        <div class="modal-content">
                            <!-- Close button to close the modal -->
                            <span class="close" onclick="paycloseModal('paymentModal')">&times;</span>
                            <h2>Payment Details</h2>
                            <p>Please complete your payment to activate your subscription.</p>

                            <!-- Masked Inputs for Card Number, Expiry Date, and CVV -->
                            <input type="text" id="cardNumber" placeholder="Card Number" style="width: 90%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 10px;" data-mask="0000 0000 0000 0000"><br>
                            <input type="text" id="expiryDate" placeholder="Expiry Date (MM/YY)" style="width: 90%; padding: 10px; margin-bottom: 10px; border: 1px solid #ccc; border-radius: 10px;" data-mask="00/00"><br>
                            <input type="text" id="cvv" placeholder="CVV" style="width: 90%; padding: 10px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 10px;" data-mask="000"><br>
                            <button class="pay-btn" onclick="confirmPayment()">Pay 100 EGP</button>
                        </div>
                    </div>




                    
  
                    
                </div>
                <div class = "package-service-inner grid">
                    <div class = "package-service-item bg-white">
                        <div class = "icon flex">
                            <i class = "fas fa-phone fa-2x"></i>
                        </div>
                        <h3>Call Case</h3>
                        <p class = "text text-sm">Exclusive priority support for Plus Members. Instant access, seamless assistance, and dedicated care whenever you need it.</p>
                        <a href = "#" class = "btn btn-blue">Read More</a>
                    </div>

                    <div class = "package-service-item bg-white">
                        <div class = "icon flex">
                            <i class = "fas fa-calendar-alt fa-2x"></i>
                        </div>
                        <h3>Timely Case</h3>
                        <p class = "text text-sm">Reliable, scheduled medicine deliveries for chronic conditions—on time, every time.</p>
                        <a href = "#" class = "btn btn-blue">Read More</a>
                    </div>
                    
                    <div class = "package-service-item bg-white">
                        <div class = "icon flex">
                            <i class = "fas fa-comments fa-2x"></i>
                        </div>
                        <h3>Chat Case</h3>
                        <p class = "text text-sm">Instant chat support for Plus Members—fast, reliable, and always here for you.</p>
                        <a href = "#" class = "btn btn-blue">Read More</a>
                    </div>
                </div>
            </div>
        </section>
        <!-- end of package services section -->

        <!-- posts section -->
        <section id = "posts" class = "posts py">
            <div class = "container">
                <div class = "section-head">
                    <h2>What Our Customers Said</h2>
                </div>
                <div class = "posts-inner grid">
                    <article class = "post-item bg-white">
                        <div class = "img">
                            <img src = "">
                        </div>
                        <div class = "content">
                            <h4>The Egyptian Pharaoh.</h4>
                            <p class = "text text-sm">The app is really wonderful. Being a Product Manager myself, I would say that the User experience (UI/UX) of the app is top notch (easy to use, simple and convenient).</p>
                            <p class = "text text-sm">Coming to services and delivery, I would say Pharmeasy is doing a tremendous job even during this unprecedented pandemic situation.</p>
                            <div class = "info flex">
                                <small class = "text text-sm"><i class = "fas fa-clock"></i> October 27, 2022</small>
                                <small class = "text text-sm"><i class = "fas fa-thumbs-up"></i> 5 Likes</small>
                            </div>
                        </div>
                    </article>

                    <article class = "post-item bg-white">
                        <div class = "img">
                            <img src = "">
                        </div>
                        <div class = "content">
                            <h4>Manal Elkhayat.</h4>
                            <p class = "text text-sm">Best service and app amongst all available. I have been using it for more than 3 years, and even during the pandemic, they have kept their standards high and are delivering the order within 24 hours.</p>
                            <p class = "text text-sm"> Keep up the good work.</p>
                            <div class = "info flex">
                                <small class = "text text-sm"><i class = "fas fa-clock"></i> October 27, 2021</small>
                                <small class = "text text-sm"><i class = "fas fa-thumbs-up"></i> 9 Likes</small>
                            </div>
                        </div>
                    </article>

                    <article class = "post-item bg-white">
                        <div class = "img">
                            <img src = "">
                        </div>
                        <div class = "content">
                            <h4>Ahmed Khaled.</h4>
                            <p class = "text text-sm">This app is a game changer for me. I am unable to go out always to buy medicinal products. MediTrack gives me the last liberty to shop essential healthcare products from home. The app is very user friendly and me being an elderly person do not find any difficulty in using it.</p>
                            <p class = "text text-sm">They deliver well in time. Thanks😊</p>
                            <div class = "info flex">
                                <small class = "text text-sm"><i class = "fas fa-clock"></i> October 27, 2021</small>
                                <small class = "text text-sm"><i class = "fas fa-thumbs-up"></i> 15 likes</small>
                            </div>
                        </div>
                    </article>
                </div>
            </div>
        </section>
        <!-- end of posts section -->

        <!-- contact section -->
        <section id = "contact" class = "contact py">
            <div class = "container grid">
                <div class = "contact-left">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3454.1234567890!2d31.2134567890!3d30.0456789012!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x145846c123456789%3A0xabcdef1234567890!2sCairo+Opera+House!5e0!3m2!1sen!2seg!4v1616161616161" width="600" height="450" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
                </div>
                <div class = "contact-right text-white text-center bg-blue">
                    <div class = "contact-head">
                        <h3 class = "lead">Contact Us</h3>
                        <p class = "text text-md">Have questions? We're here to help—reach out anytime!</p>
                    </div>
                    <form>
                        <div class = "form-element">
                            <input type = "text" class = "form-control" placeholder="Your name">
                        </div>
                        <div class = "form-element">
                            <input type = "email" class = "form-control" placeholder="Your email">
                        </div>
                        <div class = "form-element">
                            <textarea rows = "5" placeholder="Your Message" class = "form-control"></textarea>
                        </div>
                        <button type = "submit" class = "btn btn-white btn-submit">
                            <i class = "fas fa-arrow-right"></i> Send Message
                        </button>
                    </form>
                </div>
            </div>
        </section>
        <!-- end of contact section -->
    </main>

    <!-- footer  -->
    <footer id = "footer" class = "footer text-center">
        <div class = "container">
            <div class = "footer-inner text-white py grid">
                <div class = "footer-item">
                    <h3 class = "footer-head">about us</h3>
                    <div class = "icon">
                        <img src = "">
                    </div>
                    <p class = "text text-md">Meditrack is more than a service—it’s a commitment to your health. We ensure timely, reliable medicine deliveries, so you never have to worry about missing a dose!</p>
                    <ul>
                        <h3 class="footer-head"></h3>
                        <li>Order Medicine</li>
                        <li>HealthCare Products</li>
                        <li>Health Blog</li>
                    </ul>
                </div>

                <div class = "footer-item">
                    <h3 class = "footer-head">tags</h3>
                    <ul class = "tags-list flex">
                        <li>COVID Essentials</li>
                        <li>Personal Care</li>
                        <li>Health Food & Drinks</li>
                        <li>Supplements</li>
                        <li>Mother & Baby Care</li>
                        <li>Home Care</li>
                    </ul>
                </div>

                <div class = "footer-item">
                    <h3 class = "footer-head">Quick Links</h3>
                    <ul>
                        <li><a href = "#" class = "text-white">Our Services</a></li>
                        <li><a href = "#" class = "text-white">Our Plan</a></li>
                        <li><a href = "#" class = "text-white">Privacy Policy</a></li>
                        
                    </ul>
                </div>

                <div class = "footer-item">
                    <h3 class = "footer-head">Make your first Order</h3>
                    <p class = "text text-md">Customer Support Here for You.</p>
                    <ul class = "appointment-info">
                        <li>8:00 AM - 11:00 AM</li>
                        <li>2:00 PM - 05:00 PM</li>
                        <li>8:00 PM - 11:00 PM</li>
                        <li>
                            <i class = "fas fa-envelope"></i>
                            <span>meditrack@gmail.com</span>
                        </li>
                        <li>
                            <i class = "fas fa-phone"></i>
                            <span>+02 2411-5401</span>
                        </li>
                    </ul>
                </div>
            </div>

            <div class = "footer-links">
                <ul class = "flex">
                    <li><a href = "#" class = "text-white flex"> <i class = "fab fa-facebook-f"></i></a></li>
                    <li><a href = "#" class = "text-white flex"> <i class = "fab fa-twitter"></i></a></li>
                    <li><a href = "#" class = "text-white flex"> <i class = "fab fa-linkedin"></i></a></li>
                </ul>
            </div>
        </div>
    </footer>
    <!-- end of footer  -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const xhr = new XMLHttpRequest();
            xhr.open("GET", "/api/test", true); // async GET request to your test API
            xhr.onload = function () {
              if (xhr.status === 200) {
                const response = JSON.parse(xhr.responseText);
                console.log("✅ AJAX Test Response:", response.message);
              } else {
                console.error("❌ Error calling /api/test:", xhr.statusText);
              }
            };
            xhr.onerror = function () {
              console.error("❌ AJAX request failed due to network error.");
            };
            xhr.send();
        });
        </script>
        
    <script>
        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.clear();
                sessionStorage.clear();
                console.log("✅ User logged out successfully.");
                window.location.href = '/pages/login.html';
            }
            }
    </script>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // ✅ Try to get user data from localStorage
        const username = localStorage.getItem('userName');
        const email = localStorage.getItem('userEmail');
        const role = localStorage.getItem('userRole');

        // ✅ Now update profile popup if user is logged in
        if (username && email && role) {
            const usernameElement = document.querySelector('#profilePopup p:nth-of-type(1)');
            const emailElement = document.querySelector('#profilePopup p:nth-of-type(2)');
            const roleElement = document.querySelector('#profilePopup p:nth-of-type(3)');

            if (usernameElement && emailElement && roleElement) {
                usernameElement.innerHTML = `<strong>Username:</strong> ${username}`;
                emailElement.innerHTML = `<strong>Email:</strong> ${email}`;
                roleElement.innerHTML = `<strong>Role:</strong> ${capitalizeFirstLetter(role)}`;
            }
        }
    });

    function capitalizeFirstLetter(string) {
        return string.charAt(0).toUpperCase() + string.slice(1);
    }
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const role = localStorage.getItem('userRole');
    const profileLink = document.getElementById('profileLink');
    const profileLinkText = document.getElementById('profileLinkText');

    if (role && profileLink && profileLinkText) {
        if (role.toLowerCase() === 'pharmacist') {
            profileLinkText.textContent = 'Pharmacist Panel';
            profileLink.href = '/pages/pharmacist-panel.html';
            profileLink.style.display = 'inline-flex';
        } else if (role.toLowerCase() === 'admin') {
            profileLinkText.textContent = 'Admin Panel';
            profileLink.href = '/pages/admin.html';
            profileLink.style.display = 'inline-flex';
        } else if (role.toLowerCase() === 'patient') {
            profileLinkText.textContent = 'Order Status';
            profileLink.href = '/pages/order-status.html';
            profileLink.style.display = 'inline-flex';
        } else {
            profileLink.style.display = 'none'; 
        }
    } else {
        if (profileLink) {
            profileLink.style.display = 'none';
        }
    }
});

    </script>
    
    <!-- custom js -->
    <script src = "/assets/js/script.js"></script>
    <script src="/assets/js/Search.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.6/inputmask.min.js"></script>

        <!-- Prescription‐upload integration -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
              const fileInput = document.getElementById('fileInput');
              const uploadBtn = document.getElementById('uploadBtn');
        
              uploadBtn.addEventListener('click', async () => {
                const file = fileInput.files[0];
                if (!file) {
                  return alert('Please select a prescription file first.');
                }
        
                // 1) Upload to Cloudinary
                const data = new FormData();
                data.append('file', file);
                data.append('upload_preset', 'Meditrack');
        
                let cloudRes;
                try {
                  cloudRes = await fetch(
                    'https://api.cloudinary.com/v1_1/dzj5xj6sq/image/upload',
                    { method: 'POST', body: data }
                  );
                } catch (err) {
                  return alert('Network error uploading to Cloudinary.');
                }
        
                if (!cloudRes.ok) {
                  const err = await cloudRes.json();
                  console.error('Cloudinary Error:', err);
                  return alert('Upload to Cloudinary failed.');
                }
        
                const { secure_url: imageUrl } = await cloudRes.json();
                // 2) Call our backend API
                const patientId = localStorage.getItem('userId');
                const token     = localStorage.getItem('token'); // if you’re using JWT auth
                alert(patientId)

                let apiRes;
                try {
                  apiRes = await fetch('/patient/upload-prescription', {
                    method: 'POST',
                    headers: {
                      'Content-Type': 'application/json',
                      'Authorization': `Bearer ${token}`, 
                    },
                    body: JSON.stringify({ image: imageUrl, patientId:patientId })
                  });
                } catch (err) {
                  return alert('Network error sending to your API.');
                }
        
                if (!apiRes.ok) {
                  const errorBody = await apiRes.json().catch(() => ({}));
                  console.error('API Error:', errorBody);
                  return alert('Failed to save prescription.');
                }
        
                const result = await apiRes.json();
                alert(result.message || 'Prescription uploaded!');
                // optionally clear input:
                fileInput.value = '';
              });
            });
            </script>


<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Get user data from localStorage
        const userId = localStorage.getItem('userId');
        const userRole = localStorage.getItem('userRole');
        const profilePic = localStorage.getItem('userProfilePic');

        // Redirect if not logged in
        if (!userId || !userRole) {
            window.location.href = '/pages/login.html';
            return;
        }

        // Set initial profile picture from localStorage
        const profileIconImg = document.getElementById('profileIconImg');
        if (profilePic) {
            profileIconImg.src = profilePic;
        }

        // Load profile data from backend
        fetchProfileData(userId, userRole);
    });

    async function fetchProfileData(userId, userRole) {
        try {
            const headers = {
                'Content-Type': 'application/json'
            };
            const token = localStorage.getItem('token');
            if (token) {
                headers['Authorization'] = `Bearer ${token}`;
            }

            const response = await fetch(`/${userRole.toLowerCase()}/view-profile/${userId}`, {
                method: 'GET',
                headers: headers
            });

            if (!response.ok) {
                const error = await parseResponse(response);
                throw new Error(error.message || 'Failed to fetch profile');
            }

            const data = await response.json();
            console.log('Profile data loaded:', data);

            // Update profile picture if available
            const profileData = data.data || data;
            if (profileData.profile_pic) {
                document.getElementById('profileIconImg').src = profileData.profile_pic;
                localStorage.setItem('userProfilePic', profileData.profile_pic);
            }

        } catch (error) {
            console.error('Profile load error:', error);
            // Rely on onerror fallback in HTML
        }
    }

    // Helper function
    async function parseResponse(response) {
        try {
            const contentType = response.headers.get('content-type') || '';
            if (contentType.includes('application/json')) {
                return await response.json();
            }
            return { message: await response.text() };
        } catch (e) {
            return { message: response.statusText };
        }
    }
</script>
</body>
</html>